# Vulnerability Scanning

This is following Chapter 7 of Kali Linux 2019 - Working with Vulnerability Scanners.

# Nikto
In this section, we will use Nikto to check known vulnerabilities in OWASP's Multidae Application.

As mentioned in the book, Nikto is not a stealth oriented tool as it can be noisy while it is doing its scanning.

## Nikto Usage against Multidae

```sh
kali@kali:~$ nikto -h http://bwa/multidae
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.168.56.102
+ Target Hostname:    bwa
+ Target Port:        80
+ Start Time:         2020-03-03 18:46:51 (GMT-5)
---------------------------------------------------------------------------
+ Server: Apache/2.2.14 (Ubuntu) mod_mono/2.4.3 PHP/5.3.2-1ubuntu4.30 with Suhosin-Patch proxy_html/3.0.1 mod_python/3.3.1 Python/2.6.5 mod_ssl/2.2.14 OpenSSL/0.9.8k Phusion_Passenger/4.0.38 mod_perl/2.0.4 Perl/v5.10.1
+ The anti-clickjacking X-Frame-Options header is not present.                                                    
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS                                                                                                           
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type                                                                           
+ No CGI Directories found (use '-C all' to force check all possible dirs)                                        
+ OpenSSL/0.9.8k appears to be outdated (current is at least 1.1.1). OpenSSL 1.0.0o and 0.9.8zc are also current. 
+ mod_ssl/2.2.14 appears to be outdated (current is at least 2.8.31) (may depend on server version)               
+ Perl/v5.10.1 appears to be outdated (current is at least v5.20.0)                                               
+ Apache/2.2.14 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.                                                                                                            
+ mod_perl/2.0.4 appears to be outdated (current is at least 2.0.8)                                               
+ proxy_html/3.0.1 appears to be outdated (current is at least 3.1.2)                                             
+ Python/2.6.5 appears to be outdated (current is at least 2.7.8)                                                 
+ Phusion_Passenger/4.0.38 appears to be outdated (current is at least 4.0.53)                                    
+ PHP/5.3.2-1ubuntu4.30 appears to be outdated (current is at least 7.2.12). PHP 5.6.33, 7.0.27, 7.1.13, 7.2.1 may also current release for each branch.                                                                            
+ mod_mono/2.4.3 appears to be outdated (current is at least 2.8)                                                 
+ mod_ssl/2.2.14 OpenSSL/0.9.8k Phusion_Passenger/4.0.38 mod_perl/2.0.4 Perl/v5.10.1 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.                                                                                     
+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE                                                           
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST                                
+ 7679 requests: 0 error(s) and 16 item(s) reported on remote host                                                
+ End Time:           2020-03-03 18:47:00 (GMT-5) (9 seconds)                                                     
---------------------------------------------------------------------------                                       
+ 1 host(s) tested 
```

This gives us a list of items of known vulnerabilities. We can use the Open Source Vulnerability Database (OSVDB) to look up how to attack this vulnerability.

One thing that catches my eye is the ability to run a remote shell.

```
+ mod_ssl/2.2.14 OpenSSL/0.9.8k Phusion_Passenger/4.0.38 mod_perl/2.0.4 Perl/v5.10.1 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.                                                                                     
```

The link has plenty of information about this vulnerability.

We'll note this down and possible come around to this for later blogs.

# WordPressScan

Wordpress is a fairly old way of getting websites up using a Content Management System (CMS). There are still a number of sites running on this and Wordpress is still one of the most popular CMS's around.

There is a OWASP Broken Web App for Wordpress at: http://bwa/wordpress/

## WPScan Help

```sh
kali@kali:~$ wpscan --help
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.7.8
                               
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

Usage: wpscan [options]
        --url URL                                 The URL of the blog to scan
                                                  Allowed Protocols: http, https
                                                  Default Protocol if none provided: http
                                                  This option is mandatory unless update or help or hh or version is/are supplied
    -h, --help                                    Display the simple help and exit
        --hh                                      Display the full help and exit
        --version                                 Display the version and exit
    -v, --verbose                                 Verbose mode
        --[no-]banner                             Whether or not to display the banner
                                                  Default: true
    -o, --output FILE                             Output to FILE
    -f, --format FORMAT                           Output results in the format supplied
                                                  Available choices: cli-no-colour, cli-no-color, json, cli
        --detection-mode MODE                     Default: mixed
                                                  Available choices: mixed, passive, aggressive
        --user-agent, --ua VALUE
        --random-user-agent, --rua                Use a random user-agent for each scan
        --http-auth login:password
    -t, --max-threads VALUE                       The max threads to use
                                                  Default: 5
        --throttle MilliSeconds                   Milliseconds to wait before doing another web request. If used, the max threads will be set to 1.
        --request-timeout SECONDS                 The request timeout in seconds
                                                  Default: 60                                                                                                                                                               
        --connect-timeout SECONDS                 The connection timeout in seconds                                                                                                                                         
                                                  Default: 30                                                                                                                                                               
        --disable-tls-checks                      Disables SSL/TLS certificate verification, and downgrade to TLS1.0+ (requi                                                                                                res cURL 7.66 for the latter)                                                                                                                                                                                               
        --proxy protocol://IP:port                Supported protocols depend on the cURL installed                                                                                                                          
        --proxy-auth login:password                                                                                                                                                                                         
        --cookie-string COOKIE                    Cookie string to use in requests, format: cookie1=value1[; cookie2=value2]                                                                                                
        --cookie-jar FILE-PATH                    File to read and write cookies                                            
                                                  Default: /tmp/wpscan/cookie_jar.txt                                       
        --force                                   Do not check if the target is running WordPress                           
        --[no-]update                             Whether or not to update the Database                                     
        --api-token TOKEN                         The WPVulnDB API Token to display vulnerability data                      
        --wp-content-dir DIR                      The wp-content directory if custom or not detected, such as "wp-content"  
        --wp-plugins-dir DIR                      The plugins directory if custom or not detected, such as "wp-content/plugins"                                                                                                                         
    -e, --enumerate [OPTS]                        Enumeration Process                                                       
                                                  Available Choices:                                                        
                                                   vp   Vulnerable plugins
                                                   ap   All plugins
                                                   p    Popular plugins
                                                   vt   Vulnerable themes
                                                   at   All themes
                                                   t    Popular themes
                                                   tt   Timthumbs
                                                   cb   Config backups
                                                   dbe  Db exports
                                                   u    User IDs range. e.g: u1-5
                                                        Range separator to use: '-'
                                                        Value if no argument supplied: 1-10
                                                   m    Media IDs range. e.g m1-15
                                                        Note: Permalink setting must be set to "Plain" for those to be detected
                                                        Range separator to use: '-'
                                                        Value if no argument supplied: 1-100
                                                  Separator to use between the values: ','
                                                  Default: All Plugins, Config Backups
                                                  Value if no argument supplied: vp,vt,tt,cb,dbe,u,m
                                                  Incompatible choices (only one of each group/s can be used):
                                                   - vp, ap, p
                                                   - vt, at, t
        --exclude-content-based REGEXP_OR_STRING  Exclude all responses matching the Regexp (case insensitive) during parts of the enumeration.
                                                  Both the headers and body are checked. Regexp delimiters are not required.
        --plugins-detection MODE                  Use the supplied mode to enumerate Plugins, instead of the global (--detection-mode) mode.
                                                  Default: passive
                                                  Available choices: mixed, passive, aggressive
        --plugins-version-detection MODE          Use the supplied mode to check plugins versions instead of the --detection-mode or --plugins-detection modes.
                                                  Default: mixed
                                                  Available choices: mixed, passive, aggressive
    -P, --passwords FILE-PATH                     List of passwords to use during the password attack.
                                                  If no --username/s option supplied, user enumeration will be run.
    -U, --usernames LIST                          List of usernames to use during the password attack.
                                                  Examples: 'a1', 'a1,a2,a3', '/tmp/a.txt'
        --multicall-max-passwords MAX_PWD         Maximum number of passwords to send by request with XMLRPC multicall
                                                  Default: 500
        --password-attack ATTACK                  Force the supplied attack to be used rather than automatically determining one.
                                                  Available choices: wp-login, xmlrpc, xmlrpc-multicall
        --stealthy                                Alias for --random-user-agent --detection-mode passive --plugins-version-detection passive
```


## WPScan against OWASP BWA WordPress

Here is what we get when we scan OWASP BWA's WordPress App:
```sh
kali@kali:~$ wpscan --url http://bwa/wordpress
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.7.8
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://bwa/wordpress/
[+] Started: Tue Mar  3 19:10:05 2020

Interesting Finding(s):

[+] http://bwa/wordpress/
 | Interesting Entries:
 |  - Server: Apache/2.2.14 (Ubuntu) mod_mono/2.4.3 PHP/5.3.2-1ubuntu4.30 with Suhosin-Patch proxy_html/3.0.1 mod_python/3.3.1 Python/2.6.5 mod_ssl/2.2.14 OpenSSL/0.9.8k Phusion_Passenger/4.0.38 mod_perl/2.0.4 Perl/v5.10.1
 |  - X-Powered-By: PHP/5.3.2-1ubuntu4.30
 |  - Status: 200 OK
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] http://bwa/wordpress/xmlrpc.php
 | Found By: Headers (Passive Detection)
 | Confidence: 60%
 | Confirmed By: Link Tag (Passive Detection), 30% confidence
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access

[+] http://bwa/wordpress/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] WordPress version 2.0 identified (Insecure, released on 2007-09-24).
 | Found By: Rss Generator (Passive Detection)
 |  - http://bwa/wordpress/?feed=rss2, <!-- generator="wordpress/2.0" -->
 |  - http://bwa/wordpress/?feed=rss2, <generator>http://wordpress.org/?v=2.0</generator>

[+] WordPress theme in use: default
 | Location: http://bwa/wordpress/wp-content/themes/default/
 | Last Updated: 2020-02-25T00:00:00.000Z
 | [!] The version is out of date, the latest version is 1.7.2
 | Style URL: http://bwa/wordpress/wp-content/themes/default/style.css
 | Style Name: WordPress Default
 | Style URI: http://wordpress.org/
 | Description: The default WordPress theme based on the famous <a href="http://binarybonsai.com/kubrick/">Kubrick</...
 | Author: Michael Heilemann
 | Author URI: http://binarybonsai.com/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 | Confirmed By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.5 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://bwa/wordpress/wp-content/themes/default/style.css, Match: 'Version: 1.5'

[+] Enumerating All Plugins (via Passive Methods)
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] mygallery
 | Location: http://bwa/wordpress/wp-content/plugins/mygallery/
 | Latest Version: 2.0.8
 | Last Updated: 2019-10-22T14:01:00.000Z
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | The version could not be determined.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:00 <=============================================================> (21 / 21) 100.00% Time: 00:00:00

[i] No Config Backups Found.

[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up

[+] Finished: Tue Mar  3 19:10:07 2020
[+] Requests Done: 57
[+] Cached Requests: 6
[+] Data Sent: 10.479 KB
[+] Data Received: 60.17 KB
[+] Memory used: 187.984 MB
[+] Elapsed time: 00:00:02

```

## Use account enumeration

We can list out the user accounts using the `-e` enumerate flag.


```sh
kali@kali:~$ wpscan --url http://bwa/wordpress -e u vp
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.7.8
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://bwa/wordpress/
[+] Started: Tue Mar  3 19:11:45 2020

Interesting Finding(s):

[+] http://bwa/wordpress/
 | Interesting Entries:
 |  - Server: Apache/2.2.14 (Ubuntu) mod_mono/2.4.3 PHP/5.3.2-1ubuntu4.30 with Suhosin-Patch proxy_html/3.0.1 mod_python/3.3.1 Python/2.6.5 mod_ssl/2.2.14 OpenSSL/0.9.8k Phusion_Passenger/4.0.38 mod_perl/2.0.4 Perl/v5.10.1
 |  - X-Powered-By: PHP/5.3.2-1ubuntu4.30
 |  - Status: 200 OK
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] http://bwa/wordpress/xmlrpc.php
 | Found By: Headers (Passive Detection)
 | Confidence: 60%
 | Confirmed By: Link Tag (Passive Detection), 30% confidence
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access

[+] http://bwa/wordpress/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] WordPress version 2.0 identified (Insecure, released on 2007-09-24).
 | Found By: Rss Generator (Passive Detection)
 |  - http://bwa/wordpress/?feed=rss2, <!-- generator="wordpress/2.0" -->
 |  - http://bwa/wordpress/?feed=rss2, <generator>http://wordpress.org/?v=2.0</generator>

[+] WordPress theme in use: default
 | Location: http://bwa/wordpress/wp-content/themes/default/
 | Last Updated: 2020-02-25T00:00:00.000Z
 | [!] The version is out of date, the latest version is 1.7.2
 | Style URL: http://bwa/wordpress/wp-content/themes/default/style.css
 | Style Name: WordPress Default
 | Style URI: http://wordpress.org/
 | Description: The default WordPress theme based on the famous <a href="http://binarybonsai.com/kubrick/">Kubrick</...
 | Author: Michael Heilemann
 | Author URI: http://binarybonsai.com/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 | Confirmed By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.5 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://bwa/wordpress/wp-content/themes/default/style.css, Match: 'Version: 1.5'

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:01 <============================================================> (10 / 10) 100.00% Time: 00:00:01

[i] User(s) Identified:

[+] admin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)

[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up

[+] Finished: Tue Mar  3 19:11:48 2020
[+] Requests Done: 32
[+] Cached Requests: 36
[+] Data Sent: 5.682 KB
[+] Data Received: 78.359 KB
[+] Memory used: 115.391 MB
[+] Elapsed time: 00:00:03
```

With the above, we find out that there is an account called `admin`.

Let's try cracking `admin`'s password.

## Cracking passwords using SecLists

There is a github repo for known security lists. We can download it using:

```sh
kali@kali:~$ git clone https://github.com/danielmiessler/SecLists
```

For example, here is a list of the most common passwords around the web:

```sh
kali@kali:~$ head -10 SecLists/Passwords/darkweb2017-top1000.txt 
123456
123456789
111111
password
qwerty
abc123
12345678
password1
1234567
123123
```

Bruteforcing a way in by enumerating all passwords from a list:


```sh
wpscan --url http://bwa/wordpress -e u --passwords SecLists/Passwords/darkweb2017-top1000.txt 
[+] admin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)

[+] Performing password attack on Wp Login against 1 user/s
Error: Unknown response received Code: 302                                                                                                                          
Body: 
Trying admin / starstar Time: 00:03:48 <======================================================================================> (9999 / 9999) 100.00% Time: 00:03:48
```


# Reference
* Chapter 7: Working with Vulnerability Scanners - Kali Linux 2019
